---
### RHEL Specific

- name: Install Firewalld (RHEL/CentOS)
  yum:
    name: firewalld
    state: present
    update_cache: yes

- name: Start firewalld
  service:
    name: firewalld
    state: running
    enabled: yes

- name: Wait for firewalld to start
  action: command firewall-cmd --state
  register: firewall_cmd_output
  until: firewall_cmd_output.stdout.find('not running') == -1
  retries: 10
  delay: 5

# Make sure that we can SSH to the box
- firewalld:
   service: ssh
   permanent: true
   state: enabled

- name: Tag agent with firewalld in dataloop
  command: /usr/bin/dataloop-agent -a {{ dataloop_api_key }} --add-tags firewalld
  when: use_dataloop is defined and use_dataloop == True
